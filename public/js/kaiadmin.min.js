
var logoHeaderContent = $(".sidebar .logo-header").html();

function layoutsColors() {
    $(".sidebar").is("[data-background-color]") ? $("html").addClass("sidebar-color") : $("html").removeClass("sidebar-color");
}

function customBackgroundColor() {
    $('*[data-background-color="custom"]').each(function () {
        $(this).is("[custom-color]") ? $(this).css("background", $(this).attr("custom-color")) :
            $(this).is("[custom-background]") && $(this).css("background-image", "url(" + $(this).attr("custom-background") + ")");
    });
}

function legendClickCallback(e) {
    for (var s = (e = e || window.event).target || e.srcElement; "LI" !== s.nodeName;) s = s.parentElement;
    var a = s.parentElement,
        o = parseInt(a.classList[0].split("-")[0], 10),
        r = Chart.instances[o],
        l = Array.prototype.slice.call(a.children).indexOf(s);
    r.legend.options.onClick.call(r, e, r.legend.legendItems[l]);
    r.isDatasetVisible(l) ? s.classList.remove("hidden") : s.classList.add("hidden");
}

function readURL(e) {
    if (e.files && e.files[0]) {
        var s = new FileReader();
        s.onload = function (s) {
            $(e).parent(".input-file-image").find(".img-upload-preview").attr("src", s.target.result);
        };
        s.readAsDataURL(e.files[0]);
    }
}

function showPassword(e) {
    var s = $(e).parent().find("input");
    "password" === s.attr("type") ? s.attr("type", "text") : s.attr("type", "password");
}

$(".main-header .logo-header").html(logoHeaderContent);
$(".nav-search .input-group > input").focus(function (e) {
    $(this).parents().eq(2).addClass("focus");
}).blur(function (e) {
    $(this).parents().eq(2).removeClass("focus");
});

$(function () {
    let e = document.querySelectorAll('[data-bs-toggle="tooltip"]');
    [...e].map(e => new bootstrap.Tooltip(e));
    let s = document.querySelectorAll('[data-bs-toggle="popover"]');
    [...s].map(e => new bootstrap.Popover(e));
    layoutsColors();
    customBackgroundColor();
});

$(document).ready(function () {
    $(".btn-refresh-card").on("click", function () {
        var e = $(this).parents(".card");
        e.length && (e.addClass("is-loading"), setTimeout(function () { e.removeClass("is-loading"); }, 3000));
    });

    var e = $(".sidebar .scrollbar");
    e.length > 0 && e.scrollbar();
    var s = $(".main-panel .content-scroll");
    s.length > 0 && s.scrollbar();
    var a = $(".messages-scroll");
    a.length > 0 && a.scrollbar();
    var o = $(".tasks-scroll");
    o.length > 0 && o.scrollbar();
    var r = $(".quick-scroll");
    r.length > 0 && r.scrollbar();
    var l = $(".message-notif-scroll");
    l.length > 0 && l.scrollbar();
    var n = $(".notif-scroll");
    n.length > 0 && n.scrollbar();
    var i = $(".quick-actions-scroll");
    i.length > 0 && i.scrollbar();
    var t = $(".dropdown-user-scroll");
    t.length > 0 && t.scrollbar();

    $("#search-nav").on("shown.bs.collapse", function () {
        $(".nav-search .form-control").focus();
    });

    var c = !1, d = !1, g = !1, u = !1, p = !1, h = 0, m = 0, v = 0, f = 0, b = 0, C = 0;

    if (!c) {
        var k = $(".sidenav-toggler");
        k.on("click", function () {
            1 == h ? ($("html").removeClass("nav_open"), k.removeClass("toggled"), h = 0) :
                ($("html").addClass("nav_open"), k.addClass("toggled"), h = 1);
        });
        c = !0;
    }

    if (!m) {
        var k = $(".quick-sidebar-toggler");
        k.on("click", function () {
            1 == h ? ($("html").removeClass("quick_sidebar_open"), $(".quick-sidebar-overlay").remove(), k.removeClass("toggled"), m = 0) :
                ($("html").addClass("quick_sidebar_open"), k.addClass("toggled"), $('<div class="quick-sidebar-overlay"></div>').insertAfter(".quick-sidebar"), m = 1);
        });
        $(".wrapper").mouseup(function (e) {
            var s = $(".quick-sidebar");
            e.target.className == s.attr("class") || s.has(e.target).length || ($("html").removeClass("quick_sidebar_open"), $(".quick-sidebar-toggler").removeClass("toggled"), $(".quick-sidebar-overlay").remove(), m = 0);
        });
        $(".close-quick-sidebar").on("click", function () {
            $("html").removeClass("quick_sidebar_open");
            $(".quick-sidebar-toggler").removeClass("toggled");
            $(".quick-sidebar-overlay").remove();
            m = 0;
        });
        m = !0;
    }

    if (!d) {
        var w = $(".topbar-toggler");
        w.on("click", function () {
            1 == v ? ($("html").removeClass("topbar_open"), w.removeClass("toggled"), v = 0) :
                ($("html").addClass("topbar_open"), w.addClass("toggled"), v = 1);
        });
        d = !0;
    }

    if (!g) {
        var _ = $(".toggle-sidebar");
        $(".wrapper").hasClass("sidebar_minimize") && (_.addClass("toggled"), _.html('<i class="gg-more-vertical-alt"></i>'), f = 1);
        _.on("click", function () {
            1 == f ? ($(".wrapper").removeClass("sidebar_minimize"), _.removeClass("toggled"), _.html('<i class="gg-menu-right"></i>'), f = 0) :
                ($(".wrapper").addClass("sidebar_minimize"), _.addClass("toggled"), _.html('<i class="gg-more-vertical-alt"></i>'), f = 1);
            $(window).resize();
        });
        g = !0;
        u = !0;
    }

    if (!p) {
        var q = $(".page-sidebar-toggler");
        q.on("click", function () {
            1 == b ? ($("html").removeClass("pagesidebar_open"), q.removeClass("toggled"), b = 0) :
                ($("html").addClass("pagesidebar_open"), q.addClass("toggled"), b = 1);
        });
        $(".page-sidebar .back").on("click", function () {
            $("html").removeClass("pagesidebar_open");
            q.removeClass("toggled");
            b = 0;
        });
        p = !0;
    }

    var y = $(".sidenav-overlay-toggler");
    $(".wrapper").hasClass("is-show") && (C = 1, y.addClass("toggled"), y.html('<i class="icon-options-vertical"></i>'));
    y.on("click", function () {
        1 == C ? ($(".wrapper").removeClass("is-show"), y.removeClass("toggled"), y.html('<i class="icon-menu"></i>'), C = 0) :
            ($(".wrapper").addClass("is-show"), y.addClass("toggled"), y.html('<i class="icon-options-vertical"></i>'), C = 1);
        $(window).resize();
    });

    g = !0;
    $(".sidebar").mouseenter(function () {
        1 != f || u ? $(".wrapper").removeClass("sidebar_minimize_hover") : ($(".wrapper").addClass("sidebar_minimize_hover"), u = !0);
    }).mouseleave(function () {
        1 == f && u && ($(".wrapper").removeClass("sidebar_minimize_hover"), u = !1);
    });

    $(document).ready(function () {
        var activeItem = localStorage.getItem("active_nav_item");
    
        // Verifica se o usuário está na página inicial ou no dashboard
        if (window.location.href.indexOf("dashboard") > -1) {
            activeItem = "/dashboard"; // Ajuste conforme a URL do seu dashboard
        }
    
        // Se houver um item ativo armazenado no localStorage
        if (activeItem) {
            // Remove as classes "active" e "icon-active" de todos os itens e ícones
            $(".nav-item").removeClass("submenu active");
            $(".nav-item i").removeClass("icon-active");
    
            // Adiciona as classes ao item armazenado no localStorage
            var activeLink = $(".nav-item a[href='" + activeItem + "']");
            activeLink.parent().addClass("submenu active");
            activeLink.find("i").addClass("icon-active");
        }
    
        // Adiciona evento de clique aos links
        $(".nav-item a").on("click", function () {
            // Remove as classes "active" e "icon-active" de todos os itens e ícones
            $(".nav-item").removeClass("submenu active");
            $(".nav-item i").removeClass("icon-active");
    
            // Adiciona as classes "submenu active" e "icon-active" ao item clicado
            $(this).parent().addClass("submenu active");
            $(this).find("i").addClass("icon-active");
    
            // Armazena o item ativo no localStorage
            localStorage.setItem("active_nav_item", $(this).attr('href'));
        });
    });
    
    

$(document).ready(function () {
    // Ao clicar em um link dentro da classe 'filtros'
    $(".filtros a").on("click", function (event) {
        // Remove a classe 'active' de todos os links
        $(".filtros a").removeClass("active");

        // Adiciona a classe 'active' ao link clicado
        $(this).addClass("active");
    });
});


    $(document).ready(function () {
        // Ao clicar no ícone de pesquisa
        $(".search-icon").on("click", function () {
            $(".search-input").blur();
            $(".search-input").css({
                "border": "1px solid transparent",
                "background-color": "transparent"
            });

            // Alterna a classe 'search-mode' na navbar para esconder/mostrar elementos
            $(".navbar").addClass("search-mode");

            // Esconde o ícone de pesquisa e exibe o ícone de "X"
            $(".search-icon").hide();
            $(".close-search").show();

            // Exibe o campo de pesquisa e foca nele
            $(".search-form").show();
            $(".search-input").show().focus();
        });

        // Ao clicar no ícone "X"
        $(".close-search").on("click", function () {
            // Remove a classe 'search-mode' na navbar
            $(".navbar").removeClass("search-mode");

            // Esconde o ícone de "X" e exibe o ícone de pesquisa
            $(".close-search").hide();
            $(".search-icon").show();

            // Esconde o formulário e o campo de pesquisa
            $(".search-form").hide();
            $(".search-input").hide();

            // Remover o foco do campo de pesquisa
            $(".search-input").blur();  // Remove o foco
            $(".search-input").css({
                "border": "1px solid transparent",
                "background-color": "transparent"
            });
        });
    });

    $(".messages-contact .user a").on("click", function () {
        $(".tab-chat").addClass("show-chat");
    });

    $(".messages-wrapper .return").on("click", function () {
        $(".tab-chat").removeClass("show-chat");
    });

    $('[data-select="checkbox"]').change(function () {
        var e = $(this).attr("data-target");
        $(e).prop("checked", $(this).prop("checked"));
    });

    $(".form-group-default .form-control").focus(function () {
        $(this).parent().addClass("active");
    }).blur(function () {
        $(this).parent().removeClass("active");
    });
});

$('.input-file-image input[type="file"').change(function () { readURL(this); });
$(".show-password").on("click", function () { showPassword(this); });

var containerSignIn = $(".container-login"),
    containerSignUp = $(".container-signup"),
    showSignIn = !0,
    showSignUp = !1;

function changeContainer() {
    showSignIn ? containerSignIn.css("display", "block") : containerSignIn.css("display", "none");
    showSignUp ? containerSignUp.css("display", "block") : containerSignUp.css("display", "none");
}

$("#show-signup").on("click", function () {
    showSignUp = !0;
    showSignIn = !1;
    changeContainer();
});

$("#show-signin").on("click", function () {
    showSignUp = !1;
    showSignIn = !0;
    changeContainer();
});

changeContainer();

$(".form-floating-label .form-control").keyup(function () {
    "" !== $(this).val() ? $(this).addClass("filled") : $(this).removeClass("filled");
});
$(document).ready(function () {
    // Quando o botão "Alterar tipo" for clicado
    $('.btn-info').on('click', function () {
        // Recuperar os dados do usuário a partir dos atributos do botão (data-id, data-name, data-email, data-tipo)
        var userId = $(this).data('id');
        var userName = $(this).data('name');
        var userEmail = $(this).data('email');
        var userType = $(this).data('type');

        // Preencher os campos do modal com as informações do usuário
        $('#userId').val(userId);
        $('#userName').val(userName);
        $('#userEmail').val(userEmail);
        $('#userType').val(userType);

        // Mostrar o modal
        $('#editUserModal').modal('show');
    });

    // Quando o botão "Salvar alterações" for clicado
    $('#saveUserChanges').on('click', function () {
        var userId = $('#userId').val();
        var userType = $('#userType').val();

        // Enviar os dados via AJAX para o servidor
        $.ajax({
            url: '/usuarios/' + userId + '/update',  // Certifique-se de criar a rota correspondente
            method: 'PUT',
            data: {
                _token: $('meta[name="csrf-token"]').attr('content'),
                userId: userId,
                userType: userType
            },
            success: function (response) {
                // Fechar o modal
                $('#editUserModal').modal('hide');

                // Atualizar a tabela ou fazer outra ação após a alteração
                location.reload();  // Exemplo: recarregar a página
            },
            error: function (response) {
                alert("Erro ao atualizar tipo de usuário.");
            }
        });
    });
});

